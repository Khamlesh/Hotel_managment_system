{% extends "layout.html" %}

{% block title %}{{ room_type.Type_Name }} Room Details{% endblock %}

{% block content %} 
<div class="container my-5">
    <div class="row mb-4">
        <div class="col-md-8">
            <h1 class="mb-3">{{ room_type.Type_Name }} Room</h1>
            <p class="lead">{{ room_type.Description }}</p>
        </div>
        <div class="col-md-4 text-md-end">
            <div class="price-display mb-3">
                <span class="price">₹{{ "%.2f"|format(room_type.Base_Price) }}</span>
                <span class="text-muted">/night</span>
            </div>
            <a href="#booking-section" class="btn btn-primary">Book Now</a>
        </div>
    </div>
    
    <!-- Room Image Gallery -->
    <div class="row mb-5">
        <div class="col-md-8 mb-4">
            {% if room_type.Type_Name == 'Standard' %}
            <img src="https://images.unsplash.com/photo-1566665797739-1674de7a421a?w=800&h=600" class="img-fluid rounded shadow" alt="{{ room_type.Type_Name }} Room">
            {% elif room_type.Type_Name == 'Deluxe' %}
            <img src="https://images.unsplash.com/photo-1590490360182-c33d57733427?w=800&h=600" class="img-fluid rounded shadow" alt="{{ room_type.Type_Name }} Room">
            {% elif room_type.Type_Name == 'Suite' %}
            <img src="https://images.unsplash.com/photo-1591088398332-8a7791972843?w=800&h=600" class="img-fluid rounded shadow" alt="{{ room_type.Type_Name }} Room">
            {% elif room_type.Type_Name == 'Family' %}
            <img src="https://images.unsplash.com/photo-1578683010236-d716f9a3f461?w=800&h=600" class="img-fluid rounded shadow" alt="{{ room_type.Type_Name }} Room">
            {% else %}
            <img src="https://images.unsplash.com/photo-1566665797739-1674de7a421a?w=800&h=600" class="img-fluid rounded shadow" alt="{{ room_type.Type_Name }} Room">
            {% endif %}
        </div>
        <div class="col-md-4">
            <div class="row">
                <div class="col-6 mb-4">
                    {% if room_type.Type_Name == 'Standard' %}
                    <img src="https://images.unsplash.com/photo-1552321554-5fefe8c9ef14?w=400&h=300" class="img-fluid rounded shadow" alt="Bathroom">
                    {% elif room_type.Type_Name == 'Deluxe' %}
                    <img src="https://images.unsplash.com/photo-1584622650111-993a426fbf0a?w=400&h=300" class="img-fluid rounded shadow" alt="Bathroom">
                    {% elif room_type.Type_Name == 'Suite' %}
                    <img src="https://images.unsplash.com/photo-1600566752355-35792bedcfea?w=400&h=300" class="img-fluid rounded shadow" alt="Bathroom">
                    {% else %}
                    <img src="https://images.unsplash.com/photo-1552321554-5fefe8c9ef14?w=400&h=300" class="img-fluid rounded shadow" alt="Bathroom">
                    {% endif %}
                </div>
                <div class="col-6 mb-4">
                    {% if room_type.Type_Name == 'Standard' %}
                    <img src="https://images.unsplash.com/photo-1564501049412-61c2a3083791?w=400&h=300" class="img-fluid rounded shadow" alt="View">
                    {% elif room_type.Type_Name == 'Deluxe' %}
                    <img src="https://images.unsplash.com/photo-1520250497591-112f2f40a3f4?w=400&h=300" class="img-fluid rounded shadow" alt="View">
                    {% elif room_type.Type_Name == 'Suite' %}
                    <img src="https://images.unsplash.com/photo-1571896349842-33c89424de2d?w=400&h=300" class="img-fluid rounded shadow" alt="View">
                    {% else %}
                    <img src="https://images.unsplash.com/photo-1564501049412-61c2a3083791?w=400&h=300" class="img-fluid rounded shadow" alt="View">
                    {% endif %}
                </div>
                <div class="col-6 mb-4">
                    {% if room_type.Type_Name == 'Standard' %}
                    <img src="https://images.unsplash.com/photo-1572297350077-578df52e38e0?w=400&h=300" class="img-fluid rounded shadow" alt="Detail">
                    {% elif room_type.Type_Name == 'Deluxe' %}
                    <img src="https://images.unsplash.com/photo-1560750588-73207b1ef5b8?w=400&h=300" class="img-fluid rounded shadow" alt="Detail">
                    {% elif room_type.Type_Name == 'Suite' %}
                    <img src="https://images.unsplash.com/photo-1615874959474-d609969a20ed?w=400&h=300" class="img-fluid rounded shadow" alt="Detail">
                    {% else %}
                    <img src="https://images.unsplash.com/photo-1572297350077-578df52e38e0?w=400&h=300" class="img-fluid rounded shadow" alt="Detail">
                    {% endif %}
                </div>
                <div class="col-6 mb-4">
                    {% if room_type.Type_Name == 'Standard' %}
                    <img src="https://images.unsplash.com/photo-1586023492125-27b2c045efd7?w=400&h=300" class="img-fluid rounded shadow" alt="Amenity">
                    {% elif room_type.Type_Name == 'Deluxe' %}
                    <img src="https://images.unsplash.com/photo-1557127275-f8b5ba93e24e?w=400&h=300" class="img-fluid rounded shadow" alt="Amenity">
                    {% elif room_type.Type_Name == 'Suite' %}
                    <img src="https://images.unsplash.com/photo-1595576508898-0ad5c879a061?w=400&h=300" class="img-fluid rounded shadow" alt="Amenity">
                    {% else %}
                    <img src="https://images.unsplash.com/photo-1586023492125-27b2c045efd7?w=400&h=300" class="img-fluid rounded shadow" alt="Amenity">
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    
    <!-- Room Features and Amenities -->
    <div class="row mb-5">
        <div class="col-md-6 mb-4">
            <div class="card h-100 shadow">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0">Room Features</h4>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <ul class="list-unstyled">
                                <li class="mb-2"><i class="bi bi-people-fill me-2 text-primary"></i> Max Occupancy: {{ room_type.Max_Occupancy }} people</li>
                                <li class="mb-2"><i class="bi bi-layout-text-window me-2 text-primary"></i> Bed Type: {{ room_type.Bed_Type }}</li>
                                <li class="mb-2"><i class="bi bi-arrows-fullscreen me-2 text-primary"></i> Room Size: 
                                    {% if room_type.Type_Name == 'Standard' %}25m²
                                    {% elif room_type.Type_Name == 'Deluxe' %}35m²
                                    {% elif room_type.Type_Name == 'Suite' %}50m²
                                    {% else %}45m²{% endif %}
                                </li>
                                <li class="mb-2"><i class="bi bi-snow me-2 text-primary"></i> Air Conditioning</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <ul class="list-unstyled">
                                <li class="mb-2"><i class="bi bi-wifi me-2 text-primary"></i> Free Wi-Fi</li>
                                <li class="mb-2"><i class="bi bi-safe me-2 text-primary"></i> In-room Safe</li>
                                <li class="mb-2"><i class="bi bi-tv me-2 text-primary"></i> Flat-screen TV</li>
                                {% if room_type.Type_Name != 'Standard' %}
                                <li class="mb-2"><i class="bi bi-cup-hot me-2 text-primary"></i> Mini Bar</li>
                                {% endif %}
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-6 mb-4">
            <div class="card h-100 shadow">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0">Amenities</h4>
                </div>
                <div class="card-body">
                    <ul class="list-unstyled amenities-list">
                        {% for amenity in amenities %}
                        <li class="mb-2">
                            <i class="bi bi-check-circle-fill me-2 text-success"></i>
                            <strong>{{ amenity.Amenity_Name }}</strong>
                            {% if amenity.Cost > 0 %}
                            <span class="text-muted">(Additional ₹{{ "%.2f"|format(amenity.Cost) }})</span>
                            {% else %}
                            <span class="text-success">(Included)</span>
                            {% endif %}
                            {% if amenity.Description %}
                            <p class="ms-4 mb-2 small">{{ amenity.Description }}</p>
                            {% endif %}
                        </li>
                        {% endfor %}
                        
                        {% if room_type.Type_Name == 'Family' and amenities %}
                        <li class="mb-2">
                            <i class="bi bi-check-circle-fill me-2 text-success"></i>
                            <strong>Game Console</strong>
                            <span class="text-success">(Included)</span>
                            <p class="ms-4 mb-2 small">Latest gaming console with family-friendly games</p>
                        </li>
                        <li class="mb-2">
                            <i class="bi bi-check-circle-fill me-2 text-success"></i>
                            <strong>Kids Entertainment</strong>
                            <span class="text-success">(Included)</span>
                            <p class="ms-4 mb-2 small">Selection of children's movies and TV shows</p>
                        </li>
                        <li class="mb-2">
                            <i class="bi bi-check-circle-fill me-2 text-success"></i>
                            <strong>Connecting Rooms</strong>
                            <span class="text-success">(Included)</span>
                            <p class="ms-4 mb-2 small">Available on request, subject to availability</p>
                        </li>
                        <li class="mb-2">
                            <i class="bi bi-check-circle-fill me-2 text-success"></i>
                            <strong>Baby Crib</strong>
                            <span class="text-success">(Included)</span>
                            <p class="ms-4 mb-2 small">Available upon request at no extra charge</p>
                        </li>
                        <li class="mb-2">
                            <i class="bi bi-check-circle-fill me-2 text-success"></i>
                            <strong>Babysitting Service</strong>
                            <span class="text-muted">(Additional ₹500.00/hour)</span>
                            <p class="ms-4 mb-2 small">Professional childcare available with advance booking</p>
                        </li>
                        {% endif %}
                        
                        <!-- Add some default amenities if none are in database -->
                        {% if not amenities %}
                        <li class="mb-2"><i class="bi bi-check-circle-fill me-2 text-success"></i> <strong>Daily Housekeeping</strong> <span class="text-success">(Included)</span></li>
                        <li class="mb-2"><i class="bi bi-check-circle-fill me-2 text-success"></i> <strong>Fresh Towels</strong> <span class="text-success">(Included)</span></li>
                        <li class="mb-2"><i class="bi bi-check-circle-fill me-2 text-success"></i> <strong>Toiletries</strong> <span class="text-success">(Included)</span></li>
                        
                        {% if room_type.Type_Name == 'Deluxe' or room_type.Type_Name == 'Suite' %}
                        <li class="mb-2"><i class="bi bi-check-circle-fill me-2 text-success"></i> <strong>Breakfast</strong> <span class="text-success">(Included)</span></li>
                        {% else %}
                        <li class="mb-2"><i class="bi bi-check-circle-fill me-2 text-success"></i> <strong>Breakfast</strong> <span class="text-muted">(Additional ₹15.00)</span></li>
                        {% endif %}
                        
                        {% if room_type.Type_Name == 'Family' %}
                        <li class="mb-2"><i class="bi bi-check-circle-fill me-2 text-success"></i> <strong>Kids Activity Corner</strong> <span class="text-success">(Included)</span></li>
                        <li class="mb-2"><i class="bi bi-check-circle-fill me-2 text-success"></i> <strong>Welcome Pack for Children</strong> <span class="text-success">(Included)</span></li>
                        <li class="mb-2"><i class="bi bi-check-circle-fill me-2 text-success"></i> <strong>Child-Friendly Menu</strong> <span class="text-success">(Included)</span></li>
                        <li class="mb-2"><i class="bi bi-check-circle-fill me-2 text-success"></i> <strong>Babysitting Service</strong> <span class="text-muted">(Additional ₹500.00/hour)</span></li>
                        {% endif %}
                        
                        {% endif %}
                    </ul>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Available Rooms and Booking -->
    <div id="booking-section" class="card shadow mb-5">
        <div class="card-header bg-primary text-white">
            <h4 class="mb-0">Book Your Stay</h4>
        </div>
        <div class="card-body">
            <div class="row mb-4">
                <div class="col-md-6">
                    <h5>Available Rooms</h5>
                    <p>Select from our available {{ room_type.Type_Name }} rooms:</p>
                    
                    {% if available_rooms %}
                    <ul class="list-group mb-4">
                        {% for room in available_rooms %}
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <div>
                                <strong>Room {{ room.Room_Number }}</strong>
                                <br>
                                <small class="text-muted">Floor {{ room.Floor_Number }} | {{ room.Capacity }} Guests</small>
                            </div>
                            <a href="{{ url_for('book_room', room_id=room.Room_ID) }}" class="btn btn-sm btn-outline-primary">Select</a>
                        </li>
                        {% endfor %}
                    </ul>
                    {% else %}
                    <div class="alert alert-warning">
                        No rooms of this type are currently available. Please try different dates or check other room types.
                    </div>
                    {% endif %}
                </div>
                
                <div class="col-md-6">
                    <h5>Check Availability</h5>
                    <form id="availability-form" class="mb-3">
                        <input type="hidden" name="room_type_id" value="{{ room_type.Room_Type_ID }}">
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="check_in" class="form-label">Check-in Date</label>
                                <input type="date" class="form-control" id="check_in" name="check_in" required min="{{ today }}">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="check_out" class="form-label">Check-out Date</label>
                                <input type="date" class="form-control" id="check_out" name="check_out" required min="{{ today }}">
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="guests" class="form-label">Guests</label>
                                <select class="form-select" id="guests" name="guests">
                                    {% for i in range(1, room_type.Max_Occupancy + 1) %}
                                    <option value="{{ i }}" {% if i == 2 %}selected{% endif %}>{{ i }} {% if i == 1 %}Person{% else %}People{% endif %}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="discount_code" class="form-label">Discount Code</label>
                                <input type="text" class="form-control" id="discount_code" name="discount_code" placeholder="Optional">
                            </div>
                        </div>
                        
                        <div class="d-grid">
                            <button type="submit" class="btn btn-primary">Check Availability</button>
                        </div>
                    </form>
                    
                    <div id="availability-results" class="mt-3">
                        <!-- Availability results will be loaded here -->
                    </div>
                    
                    <div class="alert alert-info mt-3">
                        <i class="bi bi-info-circle-fill me-2"></i>
                        <small>Room availability is shown in real-time. Rooms with expired bookings are automatically returned to available status.</small>
                    </div>
                </div>
            </div>
            
            <div class="row mt-3">
                <div class="col-12">
                    <div class="alert alert-info">
                        <h6 class="alert-heading"><i class="bi bi-info-circle-fill me-2"></i>Booking Policy</h6>
                        <p class="mb-0 small">Check-in time is from 3:00 PM and check-out time is until 12:00 PM. A valid credit card is required to secure your reservation. Cancellations made 48 hours before check-in are fully refundable.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Room Type Comparison -->
    <div class="row mb-5">
        <div class="col-12">
            <h3 class="mb-4">Compare Room Types</h3>
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead class="table-light">
                        <tr>
                            <th>Room Type</th>
                            <th>Size</th>
                            <th>Max Guests</th>
                            <th>Bed Type</th>
                            <th>Price</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for rt in room_types %}
                        <tr {% if rt.Room_Type_ID == room_type.Room_Type_ID %}class="table-primary"{% endif %}>
                            <td>{{ rt.Type_Name }}</td>
                            <td>
                                {% if rt.Type_Name == 'Standard' %}25m²
                                {% elif rt.Type_Name == 'Deluxe' %}35m²
                                {% elif rt.Type_Name == 'Suite' %}50m²
                                {% else %}45m²{% endif %}
                            </td>
                            <td>{{ rt.Max_Occupancy }}</td>
                            <td>{{ rt.Bed_Type }}</td>
                            <td>₹{{ "%.2f"|format(rt.Base_Price) }}</td>
                            <td>
                                {% if rt.Room_Type_ID == room_type.Room_Type_ID %}
                                <span class="badge bg-primary">Current Selection</span>
                                {% else %}
                                <a href="{{ url_for('room_details', room_type_id=rt.Room_Type_ID) }}" class="btn btn-sm btn-outline-primary">View</a>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Similar Rooms -->
<section class="py-5 bg-light">
    <div class="container">
        <h2 class="text-center mb-4">Similar Room Types</h2>
        <div class="row">
            <div class="col-md-4 mb-4">
                <div class="card room-card h-100">
                    <div class="room-image">
                        <img src="https://images.unsplash.com/photo-1566665797739-1674de7a421a?w=800&h=600" class="card-img-top" alt="Standard Room">
                        <div class="price-tag">₹4500 / Night</div>
                    </div>
                    <div class="card-body">
                        <h5 class="card-title">Standard Room</h5>
                        <p class="card-text">Comfortable room with all basic amenities for a pleasant stay.</p>
                    </div>
                    <div class="card-footer bg-white border-top-0">
                        <a href="#" class="btn btn-outline-primary w-100">View Details</a>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-4">
                <div class="card room-card h-100">
                    <div class="room-image">
                        <img src="https://images.unsplash.com/photo-1590490360182-c33d57733427?w=800&h=600" class="card-img-top" alt="Deluxe Room">
                        <div class="price-tag">₹6000 / Night</div>
                    </div>
                    <div class="card-body">
                        <h5 class="card-title">Deluxe Room</h5>
                        <p class="card-text">Spacious rooms with premium amenities for a luxurious experience.</p>
                    </div>
                    <div class="card-footer bg-white border-top-0">
                        <a href="#" class="btn btn-outline-primary w-100">View Details</a>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-4">
                <div class="card room-card h-100">
                    <div class="room-image">
                        <img src="https://images.unsplash.com/photo-1591088398332-8a7791972843?w=800&h=600" class="card-img-top" alt="Family Suite">
                        <div class="price-tag">₹10000 / Night</div>
                    </div>
                    <div class="card-body">
                        <h5 class="card-title">Family Suite</h5>
                        <p class="card-text">Spacious suites perfect for families with separate living areas.</p>
                    </div>
                    <div class="card-footer bg-white border-top-0">
                        <a href="#" class="btn btn-outline-primary w-100">View Details</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

<!-- Room Detail Banner -->
<section class="page-banner">
    <div class="banner-content">
        <div class="container">
            <h1 class="display-4 text-white">{{ room_type.Type_Name }}</h1>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb justify-content-center">
                    <li class="breadcrumb-item"><a href="{{ url_for('index') }}" class="text-white">Home</a></li>
                    <li class="breadcrumb-item"><a href="{{ url_for('rooms') }}" class="text-white">Rooms</a></li>
                    <li class="breadcrumb-item active text-white" aria-current="page">{{ room_type.Type_Name }}</li>
                </ol>
            </nav>
        </div>
    </div>
</section>

<!-- Room Details -->
<section class="py-5">
    <div class="container">
        <div class="row">
            <!-- Room Images -->
            <div class="col-lg-8 mb-4 mb-lg-0">
                <div id="roomCarousel" class="carousel slide shadow" data-bs-ride="carousel">
                    <div class="carousel-indicators">
                        <button type="button" data-bs-target="#roomCarousel" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
                        <button type="button" data-bs-target="#roomCarousel" data-bs-slide-to="1" aria-label="Slide 2"></button>
                        <button type="button" data-bs-target="#roomCarousel" data-bs-slide-to="2" aria-label="Slide 3"></button>
                    </div>
                    <div class="carousel-inner rounded">
                        <div class="carousel-item active">
                            <img src="https://images.unsplash.com/photo-1566665797739-1674de7a421a?w=800&h=600" class="d-block w-100" alt="{{ room_type.Type_Name }}">
                        </div>
                        <div class="carousel-item">
                            <img src="https://images.unsplash.com/photo-1590490360182-c33d57733427?w=800&h=600" class="d-block w-100" alt="{{ room_type.Type_Name }}">
                        </div>
                        <div class="carousel-item">
                            <img src="https://images.unsplash.com/photo-1591088398332-8a7791972843?w=800&h=600" class="d-block w-100" alt="{{ room_type.Type_Name }}">
                        </div>
                    </div>
                    <button class="carousel-control-prev" type="button" data-bs-target="#roomCarousel" data-bs-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Previous</span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#roomCarousel" data-bs-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Next</span>
                    </button>
                </div>
                
                <!-- Room Description -->
                <div class="card shadow mt-4">
                    <div class="card-body">
                        <h3 class="card-title">Room Description</h3>
                        <p class="card-text">{{ room_type.Description }}</p>
                        
                        <div class="row my-4">
                            <div class="col-md-6">
                                <h5>Room Features</h5>
                                <ul class="list-unstyled">
                                    <li><i class="fas fa-bed text-primary me-2"></i> {{ room_type.Bed_Type }}</li>
                                    <li><i class="fas fa-user-friends text-primary me-2"></i> Max Occupancy: {{ room_type.Max_Occupancy }} Persons</li>
                                    <li><i class="fas fa-rupee-sign text-primary me-2"></i> Price: ₹{{ room_type.Base_Price }} / Night</li>
                                    {% if room_type.Extra_Bed_Charge > 0 %}
                                    <li><i class="fas fa-plus-circle text-primary me-2"></i> Extra Bed: ₹{{ room_type.Extra_Bed_Charge }}</li>
                                    {% endif %}
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <h5>Room Amenities</h5>
                                <div class="row">
                                    {% for amenity in amenities %}
                                    <div class="col-6 mb-2">
                                        <i class="fas fa-check-circle text-success me-2"></i> {{ amenity.Amenity_Name }}
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                        
                        <div class="room-policies mt-4">
                            <h5>Room Policies</h5>
                            <div class="row">
                                <div class="col-md-6">
                                    <p><strong>Check-in:</strong> 2:00 PM - 12:00 AM</p>
                                    <p><strong>Check-out:</strong> 12:00 PM</p>
                                    <p><strong>Pets:</strong> Not allowed</p>
                                </div>
                                <div class="col-md-6">
                                    <p><strong>Smoking:</strong> Not allowed</p>
                                    <p><strong>Children:</strong> Welcome</p>
                                    <p><strong>Cancellation:</strong> Free cancellation up to 24 hours before check-in</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Guest Reviews -->
                <div class="card shadow mt-4">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h3 class="card-title mb-0">Guest Reviews</h3>
                            <div class="review-rating">
                                <span class="badge bg-success rounded-pill">4.8 <i class="fas fa-star"></i></span>
                            </div>
                        </div>
                        
                        <div class="review-item py-3 border-bottom">
                            <div class="d-flex align-items-center mb-2">
                                <div class="reviewer-avatar me-3">
                                    <img src="https://randomuser.me/api/portraits/men/32.jpg" class="rounded-circle" alt="Guest">
                                </div>
                                <div>
                                    <h6 class="mb-0">John Smith</h6>
                                    <div class="text-muted small">Stayed in May 2023</div>
                                </div>
                                <div class="ms-auto">
                                    <div class="text-warning">
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                    </div>
                                </div>
                            </div>
                            <p class="mb-0">"Excellent room with amazing views. The bed was comfortable and the amenities were great. Would definitely stay here again."</p>
                        </div>
                        
                        <div class="review-item py-3 border-bottom">
                            <div class="d-flex align-items-center mb-2">
                                <div class="reviewer-avatar me-3">
                                    <img src="https://randomuser.me/api/portraits/women/44.jpg" class="rounded-circle" alt="Guest">
                                </div>
                                <div>
                                    <h6 class="mb-0">Emma Johnson</h6>
                                    <div class="text-muted small">Stayed in April 2023</div>
                                </div>
                                <div class="ms-auto">
                                    <div class="text-warning">
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star-half-alt"></i>
                                    </div>
                                </div>
                            </div>
                            <p class="mb-0">"Spacious room with modern amenities. The staff was friendly and helpful. Would recommend this hotel to anyone visiting the area."</p>
                        </div>
                        
                        <div class="text-center mt-3">
                            <a href="#" class="btn btn-link">Read all reviews <i class="fas fa-arrow-right"></i></a>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Booking Form -->
            <div class="col-lg-4">
                <div class="sticky-top" style="top: 20px;">
                    <div class="card shadow">
                        <div class="card-header bg-primary text-white">
                            <h4 class="mb-0">Book This Room</h4>
                        </div>
                        <div class="card-body">
                            <div class="price-summary mb-4">
                                <h3 class="text-primary">₹{{ room_type.Base_Price }} <span class="text-muted fs-6">/ night</span></h3>
                            </div>
                            
                            {% if available_rooms %}
                            <form id="room-booking-form">
                                <div class="mb-3">
                                    <label for="check_in_date" class="form-label">Check In Date</label>
                                    <input type="date" class="form-control" id="check_in_date" name="check_in_date" required min="{{ today }}">
                                </div>
                                <div class="mb-3">
                                    <label for="check_out_date" class="form-label">Check Out Date</label>
                                    <input type="date" class="form-control" id="check_out_date" name="check_out_date" required min="{{ today }}">
                                </div>
                                <div class="mb-3">
                                    <label for="available_room" class="form-label">Available Room</label>
                                    <select class="form-select" id="available_room" name="room_id" required>
                                        <option value="" selected disabled>Select a room</option>
                                        {% for room in available_rooms %}
                                        <option value="{{ room.Room_ID }}">Room {{ room.Room_Number }} (Floor {{ room.Floor_Number }})</option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label for="guests" class="form-label">Number of Guests</label>
                                    <select class="form-select" id="guests" name="guests">
                                        {% for i in range(1, room_type.Max_Occupancy + 1) %}
                                        <option value="{{ i }}" {% if i == 2 %}selected{% endif %}>{{ i }} {% if i == 1 %}Guest{% else %}Guests{% endif %}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label for="discount_code" class="form-label">Discount Code (if any)</label>
                                    <input type="text" class="form-control" id="discount_code" name="discount_code">
                                </div>
                                
                                <div class="mb-3">
                                    <div class="accordion" id="discountAccordion">
                                        <div class="accordion-item">
                                            <h2 class="accordion-header" id="discountHeading">
                                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#discountCollapse" aria-expanded="false" aria-controls="discountCollapse">
                                                    Available Discount Codes
                                                </button>
                                            </h2>
                                            <div id="discountCollapse" class="accordion-collapse collapse" aria-labelledby="discountHeading" data-bs-parent="#discountAccordion">
                                                <div class="accordion-body p-2">
                                                    <div class="row g-2">
                                                        <div class="col-6">
                                                            <div class="card border-primary h-100">
                                                                <div class="card-body p-2">
                                                                    <h6 class="discount-code mb-1">SUMMER2023</h6>
                                                                    <p class="card-text small mb-0">15% off</p>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="col-6">
                                                            <div class="card border-primary h-100">
                                                                <div class="card-body p-2">
                                                                    <h6 class="discount-code mb-1">WELCOME10</h6>
                                                                    <p class="card-text small mb-0">10% off</p>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="col-6 mt-2">
                                                            <div class="card border-primary h-100">
                                                                <div class="card-body p-2">
                                                                    <h6 class="discount-code mb-1">FAMILY25</h6>
                                                                    <p class="card-text small mb-0">25% off family rooms</p>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="col-6 mt-2">
                                                            <div class="card border-primary h-100">
                                                                <div class="card-body p-2">
                                                                    <h6 class="discount-code mb-1">WEEKEND15</h6>
                                                                    <p class="card-text small mb-0">15% off weekend stays</p>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div id="total-price-container" class="d-none">
                                    <div class="card bg-light mb-3">
                                        <div class="card-body">
                                            <h5 class="card-title">Booking Summary</h5>
                                            <div class="d-flex justify-content-between">
                                                <span>Room Price:</span>
                                                <span id="room-price">₹{{ room_type.Base_Price }} x <span id="total-nights">0</span> nights</span>
                                            </div>
                                            <div class="d-flex justify-content-between">
                                                <span>Subtotal:</span>
                                                <span id="subtotal">₹0.00</span>
                                            </div>
                                            <div id="discount-row" class="d-flex justify-content-between d-none">
                                                <span>Discount:</span>
                                                <span id="discount-amount">-₹0.00</span>
                                            </div>
                                            <hr>
                                            <div class="d-flex justify-content-between fw-bold">
                                                <span>Total:</span>
                                                <span id="total-amount">₹0.00</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="d-grid">
                                    <button type="button" id="check-availability-btn" class="btn btn-primary btn-lg">Check Availability</button>
                                    <button type="button" id="proceed-booking-btn" class="btn btn-success btn-lg mt-2 d-none">Proceed to Book</button>
                                </div>
                            </form>
                            {% else %}
                            <div class="alert alert-warning">
                                No rooms of this type are currently available. Please try another room type or adjust your dates.
                            </div>
                            <div class="d-grid">
                                <a href="{{ url_for('rooms') }}" class="btn btn-primary">Explore Other Rooms</a>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="card shadow mt-3">
                        <div class="card-body">
                            <h5>Need Assistance?</h5>
                            <p>Our dedicated staff is available 24/7 to assist with your booking.</p>
                            <div class="d-grid">
                                <a href="{{ url_for('contact') }}" class="btn btn-outline-primary">Contact Us</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const checkInInput = document.getElementById('check_in_date') || document.getElementById('check_in');
        const checkOutInput = document.getElementById('check_out_date') || document.getElementById('check_out');
        const availabilityForm = document.getElementById('availability-form');
        const bookingForm = document.getElementById('room-booking-form');
        const discountCodeInput = document.getElementById('discount_code');
        
        // Set minimum dates for inputs
        if (checkInInput) {
            const today = new Date();
            checkInInput.min = today.toISOString().split('T')[0];
            checkInInput.addEventListener('change', function() {
                if (checkOutInput) {
                    checkOutInput.min = this.value;
                }
            });
        }
        
        // Handle availability form submission
        if (availabilityForm) {
            availabilityForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const roomTypeId = this.querySelector('input[name="room_type_id"]').value;
                const checkIn = this.querySelector('input[name="check_in"]').value;
                const checkOut = this.querySelector('input[name="check_out"]').value;
                
                // Validate dates
                if (!checkIn || !checkOut || new Date(checkIn) >= new Date(checkOut)) {
                    alert('Please select valid check-in and check-out dates.');
                    return;
                }
                
                // Display loading indicator
                const resultsContainer = document.getElementById('availability-results');
                if (resultsContainer) {
                    resultsContainer.innerHTML = '<div class="text-center"><div class="spinner-border text-primary" role="status"><span class="visually-hidden">Loading...</span></div><p class="mt-2">Checking availability...</p></div>';
                }
                
                // Check availability via AJAX
                fetch('/api/check_availability', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ 
                        room_type_id: roomTypeId,
                        check_in: checkIn,
                        check_out: checkOut
                    }),
                })
                .then(response => response.json())
                .then(data => {
                    if (!resultsContainer) return;
                    
                    let html = '';
                    
                    if (data.available) {
                        html += `<div class="alert alert-success">
                            <strong>Great!</strong> We have ${data.room_count} rooms available for your selected dates.
                        </div>`;
                        
                        // Display available rooms
                        if (data.available_rooms && data.available_rooms.length > 0) {
                            html += `<div class="mt-3">
                                <h6>Available Rooms:</h6>
                                <ul class="list-group">`;
                            
                            data.available_rooms.forEach(room => {
                                html += `<li class="list-group-item d-flex justify-content-between align-items-center">
                                    <div>
                                        <strong>Room ${room.number}</strong><br>
                                        <small class="text-muted">Floor ${room.floor} | ${room.capacity} Guests</small>
                                    </div>
                                    <a href="/book-room/${room.id}?check_in=${checkIn}&check_out=${checkOut}" class="btn btn-sm btn-primary">Book Now</a>
                                </li>`;
                            });
                            
                            html += `</ul></div>`;
                        }
                        
                        // Show booked rooms if any exist
                        if (data.booked_rooms && data.booked_rooms.length > 0) {
                            html += `<div class="mt-3">
                                <h6>Currently Booked Rooms:</h6>
                                <ul class="list-group">`;
                            
                            data.booked_rooms.forEach(room => {
                                html += `<li class="list-group-item list-group-item-secondary d-flex justify-content-between align-items-center">
                                    <div>
                                        <strong>Room ${room.number}</strong><br>
                                        <small class="text-muted">Floor ${room.floor} | ${room.capacity} Guests</small>
                                    </div>
                                    <span class="badge bg-secondary">Booked</span>
                                </li>`;
                            });
                            
                            html += `</ul></div>`;
                        }
                        
                        // Show pending rooms if any exist
                        if (data.pending_rooms && data.pending_rooms.length > 0) {
                            html += `<div class="mt-3">
                                <h6>Pending Reservation Rooms:</h6>
                                <ul class="list-group">`;
                            
                            data.pending_rooms.forEach(room => {
                                html += `<li class="list-group-item list-group-item-warning d-flex justify-content-between align-items-center">
                                    <div>
                                        <strong>Room ${room.number}</strong><br>
                                        <small class="text-muted">Floor ${room.floor} | ${room.capacity} Guests</small>
                                    </div>
                                    <span class="badge bg-warning text-dark">Pending</span>
                                </li>`;
                            });
                            
                            html += `</ul></div>`;
                        }
                    } else {
                        html += `<div class="alert alert-warning">
                            <strong>Sorry!</strong> No rooms are available for the selected dates.`;
                        
                        // Show if there are pending rooms that might become available
                        if (data.pending_rooms && data.pending_rooms.length > 0) {
                            html += `<p class="mt-2 mb-0">There are ${data.pending_rooms.length} rooms with pending reservations that may become available.</p>`;
                        }
                        
                        html += `</div>`;
                        
                        // Still show the booked/pending rooms for information
                        if (data.booked_rooms && data.booked_rooms.length > 0) {
                            html += `<div class="mt-3">
                                <h6>Currently Booked Rooms:</h6>
                                <ul class="list-group">`;
                            
                            data.booked_rooms.forEach(room => {
                                html += `<li class="list-group-item list-group-item-secondary d-flex justify-content-between align-items-center">
                                    <div>
                                        <strong>Room ${room.number}</strong><br>
                                        <small class="text-muted">Floor ${room.floor} | ${room.capacity} Guests</small>
                                    </div>
                                    <span class="badge bg-secondary">Booked</span>
                                </li>`;
                            });
                            
                            html += `</ul></div>`;
                        }
                        
                        if (data.pending_rooms && data.pending_rooms.length > 0) {
                            html += `<div class="mt-3">
                                <h6>Pending Reservation Rooms:</h6>
                                <ul class="list-group">`;
                            
                            data.pending_rooms.forEach(room => {
                                html += `<li class="list-group-item list-group-item-warning d-flex justify-content-between align-items-center">
                                    <div>
                                        <strong>Room ${room.number}</strong><br>
                                        <small class="text-muted">Floor ${room.floor} | ${room.capacity} Guests</small>
                                    </div>
                                    <span class="badge bg-warning text-dark">Pending</span>
                                </li>`;
                            });
                            
                            html += `</ul></div>`;
                        }
                    }
                    
                    resultsContainer.innerHTML = html;
                })
                .catch(error => {
                    console.error('Error checking availability:', error);
                    if (resultsContainer) {
                        resultsContainer.innerHTML = '<div class="alert alert-danger">An error occurred while checking availability. Please try again.</div>';
                    }
                });
            });
        }
        
        // Handle availability check button
        const checkAvailabilityBtn = document.getElementById('check-availability-btn');
        if (checkAvailabilityBtn) {
            checkAvailabilityBtn.addEventListener('click', function() {
                const checkIn = document.getElementById('check_in_date').value;
                const checkOut = document.getElementById('check_out_date').value;
                const roomTypeId = {{ room_type.Room_Type_ID }};
                
                // Validate dates
                if (!checkIn || !checkOut || new Date(checkIn) >= new Date(checkOut)) {
                    alert('Please select valid check-in and check-out dates.');
                    return;
                }
                
                // Check availability and show rooms
                fetch('/api/check_availability', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ 
                        room_type_id: roomTypeId,
                        check_in: checkIn,
                        check_out: checkOut
                    }),
                })
                .then(response => response.json())
                .then(data => {
                    if (data.available) {
                        // Create room selection dropdown
                        const roomSelectDiv = document.createElement('div');
                        roomSelectDiv.className = 'mb-3';
                        
                        const roomSelectLabel = document.createElement('label');
                        roomSelectLabel.htmlFor = 'available_room';
                        roomSelectLabel.className = 'form-label';
                        roomSelectLabel.textContent = 'Select a Room';
                        
                        const roomSelect = document.createElement('select');
                        roomSelect.className = 'form-select';
                        roomSelect.id = 'available_room';
                        roomSelect.name = 'available_room';
                        roomSelect.required = true;
                        
                        // Add a default option
                        const defaultOption = document.createElement('option');
                        defaultOption.value = '';
                        defaultOption.textContent = 'Choose a room...';
                        defaultOption.selected = true;
                        roomSelect.appendChild(defaultOption);
                        
                        // Add available rooms to select
                        data.available_rooms.forEach(room => {
                            const option = document.createElement('option');
                            option.value = room.id;
                            option.textContent = `Room ${room.number} (Floor ${room.floor}, ${room.capacity} Guests)`;
                            roomSelect.appendChild(option);
                        });
                        
                        roomSelectDiv.appendChild(roomSelectLabel);
                        roomSelectDiv.appendChild(roomSelect);
                        
                        // Add to form before the buttons
                        const buttonsDiv = document.querySelector('#room-booking-form .d-grid');
                        bookingForm.insertBefore(roomSelectDiv, buttonsDiv);
                        
                        // Show proceed button, hide check availability button
                        document.getElementById('proceed-booking-btn').classList.remove('d-none');
                        this.classList.add('d-none');
                        
                        // Create alert for available rooms
                        const alertDiv = document.createElement('div');
                        alertDiv.className = 'alert alert-success mb-3';
                        alertDiv.textContent = `${data.available_rooms.length} rooms available for the selected dates.`;
                        bookingForm.insertBefore(alertDiv, roomSelectDiv);
                        
                        // If there are pending or booked rooms, show status info
                        if ((data.pending_rooms && data.pending_rooms.length > 0) || 
                            (data.booked_rooms && data.booked_rooms.length > 0)) {
                            const statusInfoDiv = document.createElement('div');
                            statusInfoDiv.className = 'small text-muted mb-3';
                            statusInfoDiv.innerHTML = `
                                <p class="mb-1"><span class="badge bg-secondary me-1">Booked</span> - ${data.booked_rooms ? data.booked_rooms.length : 0} rooms are already booked.</p>
                                <p class="mb-0"><span class="badge bg-warning text-dark me-1">Pending</span> - ${data.pending_rooms ? data.pending_rooms.length : 0} rooms have pending reservations.</p>
                            `;
                            bookingForm.insertBefore(statusInfoDiv, buttonsDiv);
                        }
                    } else {
                        alert('Sorry, no rooms are available for the selected dates. Please try different dates.');
                    }
                })
                .catch(error => {
                    console.error('Error checking availability:', error);
                    alert('An error occurred while checking availability. Please try again.');
                });
            });
        }
        
        if (bookingForm) {
            const proceedButton = document.getElementById('proceed-booking-btn');
            if (proceedButton) {
                proceedButton.addEventListener('click', function() {
                    // Get the selected room ID
                    const roomSelect = document.getElementById('available_room');
                    if (roomSelect && roomSelect.value) {
                        window.location.href = '/book-room/' + roomSelect.value + 
                            '?check_in=' + checkInInput.value + 
                            '&check_out=' + checkOutInput.value + 
                            '&guests=' + document.getElementById('guests').value +
                            (discountCodeInput && discountCodeInput.value ? 
                             '&discount=' + encodeURIComponent(discountCodeInput.value) : '');
                    } else {
                        alert('Please select an available room.');
                    }
                });
            }
        }
        
        // Enable automatic cleanup of expired bookings when users are viewing room details
        // This helps ensure availability data is always current
        function checkForExpiredBookings() {
            fetch('/cleanup_expired_bookings')
                .then(response => response.json())
                .then(data => {
                    if (data.success && data.message.includes("rooms freed")) {
                        console.log("Expired bookings cleaned up: " + data.message);
                        // If rooms were freed, refresh the availability data
                        if (data.message.includes("rooms freed: 0") === false) {
                            const roomTypeId = {{ room_type.Room_Type_ID }};
                            const checkInField = document.getElementById('check_in') || document.getElementById('check_in_date');
                            const checkOutField = document.getElementById('check_out') || document.getElementById('check_out_date');
                            
                            if (checkInField && checkInField.value && checkOutField && checkOutField.value) {
                                // Refresh availability data if we have dates selected
                                fetch('/api/check_availability', {
                                    method: 'POST',
                                    headers: {
                                        'Content-Type': 'application/json',
                                    },
                                    body: JSON.stringify({ 
                                        room_type_id: roomTypeId,
                                        check_in: checkInField.value,
                                        check_out: checkOutField.value
                                    }),
                                })
                                .then(response => response.json())
                                .then(data => {
                                    // If rooms are now available that weren't before, show a notification
                                    if (data.available && data.available_rooms && data.available_rooms.length > 0) {
                                        const notification = document.createElement('div');
                                        notification.className = 'alert alert-info alert-dismissible fade show';
                                        notification.innerHTML = `
                                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                                            <strong>Good news!</strong> New rooms have become available for your selected dates.
                                        `;
                                        document.querySelector('.container').prepend(notification);
                                        
                                        // Auto-dismiss after 10 seconds
                                        setTimeout(() => {
                                            notification.classList.remove('show');
                                            setTimeout(() => notification.remove(), 500);
                                        }, 10000);
                                    }
                                })
                                .catch(error => console.error('Error refreshing availability:', error));
                            }
                        }
                    }
                })
                .catch(error => console.error('Error checking expired bookings:', error));
        }
        
        // Check for expired bookings when page loads
        checkForExpiredBookings();
        
        // Set up periodic check every 5 minutes
        setInterval(checkForExpiredBookings, 5 * 60 * 1000);
    });
</script>
{% endblock %}