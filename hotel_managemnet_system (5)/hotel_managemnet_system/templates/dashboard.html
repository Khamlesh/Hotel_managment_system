{% extends "layout.html" %}

{% block title %}My Dashboard{% endblock %}

{% block content %}
<div class="container my-5">
    <!-- Emergency Maintenance Link -->
    <div class="alert alert-warning mb-4" role="alert">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h5 class="alert-heading mb-1"><i class="fas fa-tools me-2"></i>Need to report a maintenance issue?</h5>
                <p class="mb-0">Report any room maintenance issues directly to our staff.</p>
            </div>
            <a href="{{ url_for('maintenance') }}" class="btn btn-primary" id="direct-maintenance-link">Report Issue</a>
        </div>
    </div>
    
    <div class="row">
        <div class="col-lg-3 mb-4">
            <div class="card dashboard-card shadow">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">My Profile</h5>
                </div>
                <div class="card-body">
                    <div class="text-center mb-3">
                        <i class="fas fa-user-circle fa-5x text-primary"></i>
                    </div>
                    <h5 class="text-center mb-3">{{ user.First_Name }} {{ user.Last_Name }}</h5>
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item d-flex justify-content-between">
                            <span><i class="fas fa-envelope me-2"></i>Email:</span>
                            <span class="text-muted">{{ user.Email }}</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between">
                            <span><i class="fas fa-phone me-2"></i>Contact:</span>
                            <span class="text-muted">{{ user.Contact_Number }}</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between">
                            <span><i class="fas fa-award me-2"></i>Status:</span>
                            <span class="badge bg-success">{{ user.Membership_Status }}</span>
                        </li>
                    </ul>
                    <div class="d-grid gap-2 mt-3">
                        <a href="{{ url_for('edit_profile') }}" class="btn btn-outline-primary"><i class="fas fa-edit me-2"></i>Edit Profile</a>
                    </div>
                </div>
            </div>
            
            <div class="card dashboard-card shadow mt-4">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0">Quick Actions</h5>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <a href="{{ url_for('rooms') }}" class="btn btn-outline-success"><i class="fas fa-bed me-2"></i>Book a Room</a>
                        <a href="{{ url_for('services') }}" class="btn btn-outline-success"><i class="fas fa-concierge-bell me-2"></i>View Services</a>
                        <a href="{{ url_for('events') }}" class="btn btn-outline-success"><i class="fas fa-calendar-day me-2"></i>Explore Events</a>
                        <a href="{{ url_for('maintenance') }}" class="btn btn-outline-success"><i class="fas fa-tools me-2"></i>Report Room Issue</a>
                        <a href="{{ url_for('maintenance_history') }}" class="btn btn-outline-success"><i class="fas fa-history me-2"></i>Maintenance History</a>
                        <a href="{{ url_for('submit_maintenance') }}" class="btn btn-outline-success"><i class="fas fa-wrench me-2"></i>Report Facility Issue</a>
                        <!-- <a href="{{ url_for('maintenance_diagnostic') }}" class="btn btn-outline-secondary"><i class="fas fa-database me-2"></i>Maintenance Diagnostic</a> -->
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-lg-9">
            <div class="card dashboard-card shadow mb-4">
                <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">My Reservations</h5>
                    <a href="{{ url_for('rooms') }}" class="btn btn-sm btn-light">Book a Room</a>
                </div>
                <div class="card-body">
                    {% if reservations %}
                    <div class="table-responsive">
                        <table class="table table-hover align-middle">
                            <thead class="table-light">
                                <tr>
                                    <th>Reservation #</th>
                                    <th>Room</th>
                                    <th>Dates</th>
                                    <th>Total Cost</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for reservation in reservations %}
                                <tr>
                                    <td class="fw-bold">
                                        <span class="badge bg-primary">#{{ reservation.Reservation_ID }}</span>
                                    </td>
                                    <td>
                                        {% if reservation.room %}
                                            <div>
                                                <strong>{{ reservation.room.room_type.Type_Name }}</strong><br>
                                                Room {{ reservation.room.Room_Number }}
                                            </div>
                                        {% else %}
                                            Not Assigned
                                        {% endif %}
                                    </td>
                                    <td>
                                        <div>
                                            <i class="far fa-calendar-check text-success me-1"></i> {{ reservation.Check_In_Date.strftime('%b %d, %Y') }}<br>
                                            <i class="far fa-calendar-times text-danger me-1"></i> {{ reservation.Check_Out_Date.strftime('%b %d, %Y') }}
                                        </div>
                                    </td>
                                    <td class="text-primary fw-bold">â‚¹{{ "%.2f"|format(reservation.Total_Cost) }}</td>
                                    <td>
                                        {% if reservation.Status == 'Confirmed' %}
                                            <span class="badge bg-success rounded-pill">{{ reservation.Status }}</span>
                                        {% elif reservation.Status == 'Pending' %}
                                            <span class="badge bg-warning text-dark rounded-pill">{{ reservation.Status }}</span>
                                        {% else %}
                                            <span class="badge bg-danger rounded-pill">{{ reservation.Status }}</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <div class="btn-group btn-group-sm">
                                            <button type="button" class="btn btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#reservationModal{{ reservation.Reservation_ID }}">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                            {% if reservation.Status != 'Canceled' %}
                                            <button type="button" class="btn btn-outline-danger" data-bs-toggle="modal" data-bs-target="#cancelModal{{ reservation.Reservation_ID }}" title="Cancel Reservation">
                                                <i class="fas fa-times"></i>
                                            </button>
                                            {% endif %}
                                            {% if reservation.Status == 'Confirmed' and not reservation.feedback %}
                                            <a href="{{ url_for('submit_feedback', reservation_id=reservation.Reservation_ID) }}" class="btn btn-outline-primary" data-bs-toggle="tooltip" title="Leave Feedback">
                                                <i class="fas fa-comment"></i>
                                            </a>
                                            {% endif %}
                                        </div>
                                        
                                        <!-- Cancellation Confirmation Modal -->
                                        <div class="modal fade" id="cancelModal{{ reservation.Reservation_ID }}" tabindex="-1" aria-labelledby="cancelModalLabel{{ reservation.Reservation_ID }}" aria-hidden="true">
                                            <div class="modal-dialog">
                                                <div class="modal-content">
                                                    <div class="modal-header bg-danger text-white">
                                                        <h5 class="modal-title" id="cancelModalLabel{{ reservation.Reservation_ID }}">Cancel Reservation</h5>
                                                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                                                    </div>
                                                    <div class="modal-body">
                                                        <p>Are you sure you want to cancel your reservation for:</p>
                                                        <div class="card bg-light mb-3">
                                                            <div class="card-body">
                                                                {% if reservation.room %}
                                                                <p class="mb-1"><strong>Room:</strong> {{ reservation.room.room_type.Type_Name }} Room {{ reservation.room.Room_Number }}</p>
                                                                {% endif %}
                                                                <p class="mb-1"><strong>Check-in:</strong> {{ reservation.Check_In_Date.strftime('%B %d, %Y') }}</p>
                                                                <p class="mb-1"><strong>Check-out:</strong> {{ reservation.Check_Out_Date.strftime('%B %d, %Y') }}</p>
                                                                <p class="mb-0"><strong>Total Cost:</strong> â‚¹{{ "%.2f"|format(reservation.Total_Cost) }}</p>
                                                            </div>
                                                        </div>
                                                        <div class="alert alert-warning">
                                                            <i class="fas fa-exclamation-triangle me-2"></i> 
                                                            {% if reservation.Check_In_Date <= today %}
                                                            <strong>Please note:</strong> Cancellation policy may apply as your check-in date has arrived or passed.
                                                            {% else %}
                                                            <strong>Please note:</strong> Free cancellation is available up to 24 hours before check-in. After that, cancellation fees may apply.
                                                            {% endif %}
                                                        </div>
                                                    </div>
                                                    <div class="modal-footer">
                                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Keep Reservation</button>
                                                        <form action="{{ url_for('cancel_reservation', reservation_id=reservation.Reservation_ID) }}" method="post">
                                                            <button type="submit" class="btn btn-danger">Confirm Cancellation</button>
                                                        </form>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Reservation Details Modal -->
                                        <div class="modal fade" id="reservationModal{{ reservation.Reservation_ID }}" tabindex="-1" aria-labelledby="reservationModalLabel{{ reservation.Reservation_ID }}" aria-hidden="true">
                                            <div class="modal-dialog">
                                                <div class="modal-content">
                                                    <div class="modal-header bg-primary text-white">
                                                        <h5 class="modal-title" id="reservationModalLabel{{ reservation.Reservation_ID }}">Reservation Details #{{ reservation.Reservation_ID }}</h5>
                                                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                                                    </div>
                                                    <div class="modal-body">
                                                        {% if reservation.room %}
                                                        <div class="text-center mb-4">
                                                            {% if reservation.room.room_type.Type_Name == 'Standard' %}
                                                            <img src="https://images.unsplash.com/photo-1611892440504-42a792e24d32?q=80&w=1770&auto=format&fit=crop" class="img-fluid rounded mb-3" alt="Room Image" style="max-height: 200px; object-fit: cover;">
                                                            {% elif reservation.room.room_type.Type_Name == 'Deluxe' %}
                                                            <img src="https://images.unsplash.com/photo-1618773928121-c32242e63f39?q=80&w=1770&auto=format&fit=crop" class="img-fluid rounded mb-3" alt="Room Image" style="max-height: 200px; object-fit: cover;">
                                                            {% elif reservation.room.room_type.Type_Name == 'Suite' %}
                                                            <img src="https://images.unsplash.com/photo-1591088398332-8a7791972843?q=80&w=1774&auto=format&fit=crop" class="img-fluid rounded mb-3" alt="Room Image" style="max-height: 200px; object-fit: cover;">
                                                            {% else %}
                                                            <img src="https://dynamic-media-cdn.tripadvisor.com/media/photo-o/27/2b/d4/95/family-room.jpg?w=900&h=500&s=1" class="img-fluid rounded mb-3" alt="Room Image" style="max-height: 200px; object-fit: cover;">
                                                            {% endif %}
                                                            <h5>{{ reservation.room.room_type.Type_Name }} Room {{ reservation.room.Room_Number }}</h5>
                                                        </div>
                                                        {% endif %}
                                                        
                                                        <div class="row mb-2">
                                                            <div class="col-6 fw-bold">Status:</div>
                                                            <div class="col-6">
                                                                {% if reservation.Status == 'Confirmed' %}
                                                                    <span class="badge bg-success">{{ reservation.Status }}</span>
                                                                {% elif reservation.Status == 'Pending' %}
                                                                    <span class="badge bg-warning text-dark">{{ reservation.Status }}</span>
                                                                {% else %}
                                                                    <span class="badge bg-danger">{{ reservation.Status }}</span>
                                                                {% endif %}
                                                            </div>
                                                        </div>
                                                        <div class="row mb-2">
                                                            <div class="col-6 fw-bold">Check-in Date:</div>
                                                            <div class="col-6">{{ reservation.Check_In_Date.strftime('%B %d, %Y') }}</div>
                                                        </div>
                                                        <div class="row mb-2">
                                                            <div class="col-6 fw-bold">Check-out Date:</div>
                                                            <div class="col-6">{{ reservation.Check_Out_Date.strftime('%B %d, %Y') }}</div>
                                                        </div>
                                                        <div class="row mb-2">
                                                            <div class="col-6 fw-bold">Total Cost:</div>
                                                            <div class="col-6 text-primary fw-bold">â‚¹{{ "%.2f"|format(reservation.Total_Cost) }}</div>
                                                        </div>
                                                        
                                                        {% if reservation.payments %}
                                                        <div class="mt-4">
                                                            <h6 class="fw-bold mb-3">Payment Information:</h6>
                                                            {% for payment in reservation.payments %}
                                                            <div class="card bg-light mb-2">
                                                                <div class="card-body p-3">
                                                                    <div class="row mb-1">
                                                                        <div class="col-6 fw-bold">Payment Date:</div>
                                                                        <div class="col-6">{{ payment.Payment_Date.strftime('%B %d, %Y') }}</div>
                                                                    </div>
                                                                    <div class="row mb-1">
                                                                        <div class="col-6 fw-bold">Method:</div>
                                                                        <div class="col-6">{{ payment.Payment_Method }}</div>
                                                                    </div>
                                                                    <div class="row mb-1">
                                                                        <div class="col-6 fw-bold">Amount:</div>
                                                                        <div class="col-6">â‚¹{{ "%.2f"|format(payment.Amount) }}</div>
                                                                    </div>
                                                                    <div class="row">
                                                                        <div class="col-6 fw-bold">Status:</div>
                                                                        <div class="col-6">
                                                                            {% if payment.Transaction_Status == 'Successful' %}
                                                                                <span class="badge bg-success">{{ payment.Transaction_Status }}</span>
                                                                            {% else %}
                                                                                <span class="badge bg-danger">{{ payment.Transaction_Status }}</span>
                                                                            {% endif %}
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            {% endfor %}
                                                        </div>
                                                        {% endif %}
                                                    </div>
                                                    <div class="modal-footer">
                                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                                        {% if reservation.Status == 'Confirmed' %}
                                                            <a href="{{ url_for('submit_feedback', reservation_id=reservation.Reservation_ID) }}" class="btn btn-primary">Leave Feedback</a>
                                                            {% if reservation.Check_Out_Date >= today %}
                                                            <a href="{{ url_for('maintenance') }}" class="btn btn-warning">
                                                                <i class="fas fa-tools me-1"></i>Report Issue
                                                            </a>
                                                            {% endif %}
                                                        {% endif %}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <div class="text-center py-5">
                        <i class="fas fa-calendar-alt fa-5x text-muted mb-3"></i>
                        <h4>No Reservations Found</h4>
                        <p class="text-muted">You don't have any reservations yet. Start by booking a room!</p>
                        <a href="{{ url_for('rooms') }}" class="btn btn-primary">Browse Rooms</a>
                    </div>
                    {% endif %}
                </div>
            </div>
            
            <!-- Event Bookings Section -->
            <div class="card dashboard-card shadow mb-4">
                <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">My Event Bookings</h5>
                    <a href="{{ url_for('events') }}" class="btn btn-sm btn-light">Explore Events</a>
                </div>
                <div class="card-body">
                    {% if event_bookings %}
                    <div class="table-responsive">
                        <table class="table table-hover align-middle">
                            <thead class="table-light">
                                <tr>
                                    <th>Booking #</th>
                                    <th>Event</th>
                                    <th>Date</th>
                                    <th>Cost</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for booking in event_bookings %}
                                <tr>
                                    <td class="fw-bold">
                                        <span class="badge bg-success">#{{ booking.Event_Booking_ID }}</span>
                                    </td>
                                    <td>
                                        {% if booking.event_details %}
                                        <div>
                                            <strong>{{ booking.event_details.Event_Name }}</strong><br>
                                            <small class="text-muted">{{ booking.event_details.Location }}</small>
                                        </div>
                                        {% else %}
                                            Unknown Event
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if booking.event_details %}
                                        <div>
                                            <i class="fas fa-calendar-day text-success me-1"></i> {{ booking.event_details.Event_Date.strftime('%b %d, %Y') }}
                                        </div>
                                        {% else %}
                                            Not Available
                                        {% endif %}
                                    </td>
                                    <td class="text-success fw-bold">â‚¹{{ "%.2f"|format(booking.Total_Cost) }}</td>
                                    <td>
                                        {% if booking.Status == 'Confirmed' %}
                                            <span class="badge bg-success rounded-pill">{{ booking.Status }}</span>
                                        {% elif booking.Status == 'Pending' %}
                                            <span class="badge bg-warning text-dark rounded-pill">{{ booking.Status }}</span>
                                        {% else %}
                                            <span class="badge bg-danger rounded-pill">{{ booking.Status }}</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <div class="btn-group btn-group-sm">
                                            <button type="button" class="btn btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#eventBookingModal{{ booking.Event_Booking_ID }}">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                            {% if booking.Status != 'Canceled' %}
                                            <button type="button" class="btn btn-outline-danger" data-bs-toggle="modal" data-bs-target="#cancelEventModal{{ booking.Event_Booking_ID }}" title="Cancel Event Booking">
                                                <i class="fas fa-times"></i>
                                            </button>
                                            {% endif %}
                                        </div>
                                        
                                        <!-- Event Booking Details Modal -->
                                        <div class="modal fade" id="eventBookingModal{{ booking.Event_Booking_ID }}" tabindex="-1" aria-labelledby="eventBookingModalLabel{{ booking.Event_Booking_ID }}" aria-hidden="true">
                                            <div class="modal-dialog">
                                                <div class="modal-content">
                                                    <div class="modal-header bg-success text-white">
                                                        <h5 class="modal-title" id="eventBookingModalLabel{{ booking.Event_Booking_ID }}">Event Booking #{{ booking.Event_Booking_ID }}</h5>
                                                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                                                    </div>
                                                    <div class="modal-body">
                                                        {% if booking.event_details %}
                                                        <div class="text-center mb-4">
                                                            {% if booking.event_details.Event_Name == 'Wine Tasting' %}
                                                            <img src="https://images.unsplash.com/photo-1423483641154-5411ec9c0ddf?q=80&w=1470&auto=format&fit=crop" class="img-fluid rounded mb-3" alt="Event Image" style="max-height: 200px; object-fit: cover;">
                                                            {% elif booking.event_details.Event_Name == 'Live Music' %}
                                                            <img src="https://images.unsplash.com/photo-1506157786151-b8491531f063?q=80&w=2070&auto=format&fit=crop" class="img-fluid rounded mb-3" alt="Event Image" style="max-height: 200px; object-fit: cover;">
                                                            {% elif booking.event_details.Event_Name == 'Cooking Class' %}
                                                            <img src="https://images.unsplash.com/photo-1507048331197-7d4ac70811cf?q=80&w=1374&auto=format&fit=crop" class="img-fluid rounded mb-3" alt="Event Image" style="max-height: 200px; object-fit: cover;">
                                                            {% elif booking.event_details.Event_Name == 'Yoga Session' %}
                                                            <img src="https://images.unsplash.com/photo-1599901860904-17e6ed7083a0?q=80&w=1470&auto=format&fit=crop" class="img-fluid rounded mb-3" alt="Event Image" style="max-height: 200px; object-fit: cover;">
                                                            {% elif booking.event_details.Event_Name == 'Cultural Dance Night' %}
                                                            <img src="https://images.unsplash.com/photo-1545224144-b38cd309f1c6?q=80&w=1470&auto=format&fit=crop" class="img-fluid rounded mb-3" alt="Event Image" style="max-height: 200px; object-fit: cover;">
                                                            {% else %}
                                                            <img src="https://images.unsplash.com/photo-1511795409834-ef04bbd61622?q=80&w=1470&auto=format&fit=crop" class="img-fluid rounded mb-3" alt="Event Image" style="max-height: 200px; object-fit: cover;">
                                                            {% endif %}
                                                            <h5>{{ booking.event_details.Event_Name }}</h5>
                                                        </div>
                                                        {% endif %}
                                                        
                                                        <div class="row mb-2">
                                                            <div class="col-6 fw-bold">Status:</div>
                                                            <div class="col-6">
                                                                {% if booking.Status == 'Confirmed' %}
                                                                    <span class="badge bg-success">{{ booking.Status }}</span>
                                                                {% elif booking.Status == 'Pending' %}
                                                                    <span class="badge bg-warning text-dark">{{ booking.Status }}</span>
                                                                {% else %}
                                                                    <span class="badge bg-danger">{{ booking.Status }}</span>
                                                                {% endif %}
                                                            </div>
                                                        </div>
                                                        
                                                        {% if booking.event_details %}
                                                        <div class="row mb-2">
                                                            <div class="col-6 fw-bold">Event Date:</div>
                                                            <div class="col-6">{{ booking.event_details.Event_Date.strftime('%B %d, %Y') }}</div>
                                                        </div>
                                                        <div class="row mb-2">
                                                            <div class="col-6 fw-bold">Location:</div>
                                                            <div class="col-6">{{ booking.event_details.Location }}</div>
                                                        </div>
                                                        <div class="row mb-2">
                                                            <div class="col-6 fw-bold">Event Description:</div>
                                                            <div class="col-6">{{ booking.event_details.Description|truncate(100) }}</div>
                                                        </div>
                                                        {% endif %}
                                                        
                                                        <div class="row mb-2">
                                                            <div class="col-6 fw-bold">Booking Date:</div>
                                                            <div class="col-6">{{ booking.Booking_Date.strftime('%B %d, %Y') }}</div>
                                                        </div>
                                                        <div class="row mb-2">
                                                            <div class="col-6 fw-bold">Total Cost:</div>
                                                            <div class="col-6 text-success fw-bold">â‚¹{{ "%.2f"|format(booking.Total_Cost) }}</div>
                                                        </div>
                                                        
                                                        {% if booking.Special_Requests %}
                                                        <div class="mt-4">
                                                            <h6 class="fw-bold mb-2">Special Requests:</h6>
                                                            <div class="card bg-light">
                                                                <div class="card-body p-3">
                                                                    {{ booking.Special_Requests }}
                                                                </div>
                                                            </div>
                                                        </div>
                                                        {% endif %}
                                                        
                                                        <div class="mt-4">
                                                            <div class="alert alert-info">
                                                                <i class="fas fa-info-circle me-2"></i>
                                                                <strong>Event Check-in:</strong> Please arrive 30 minutes prior to the event with your booking ID for seamless check-in.
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="modal-footer">
                                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                                        <button type="button" class="btn btn-success" onclick="window.print()">
                                                            <i class="fas fa-print me-2"></i>Print Details
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Event Booking Cancellation Modal -->
                                        <div class="modal fade" id="cancelEventModal{{ booking.Event_Booking_ID }}" tabindex="-1" aria-labelledby="cancelEventModalLabel{{ booking.Event_Booking_ID }}" aria-hidden="true">
                                            <div class="modal-dialog">
                                                <div class="modal-content">
                                                    <div class="modal-header bg-danger text-white">
                                                        <h5 class="modal-title" id="cancelEventModalLabel{{ booking.Event_Booking_ID }}">Cancel Event Booking</h5>
                                                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                                                    </div>
                                                    <div class="modal-body">
                                                        <p>Are you sure you want to cancel your booking for:</p>
                                                        <div class="card bg-light mb-3">
                                                            <div class="card-body">
                                                                {% if booking.event_details %}
                                                                <p class="mb-1"><strong>Event:</strong> {{ booking.event_details.Event_Name }}</p>
                                                                <p class="mb-1"><strong>Date:</strong> {{ booking.event_details.Event_Date.strftime('%B %d, %Y') }}</p>
                                                                <p class="mb-1"><strong>Location:</strong> {{ booking.event_details.Location }}</p>
                                                                {% endif %}
                                                                <p class="mb-0"><strong>Total Cost:</strong> â‚¹{{ "%.2f"|format(booking.Total_Cost) }}</p>
                                                            </div>
                                                        </div>
                                                        <div class="alert alert-warning">
                                                            <i class="fas fa-exclamation-triangle me-2"></i> 
                                                            {% if booking.event_details and (booking.event_details.Event_Date - today).days < 2 %}
                                                            <strong>Please note:</strong> Cancellation within 48 hours of the event may incur charges as per our policy.
                                                            {% else %}
                                                            <strong>Please note:</strong> Free cancellation is available up to 48 hours before the event. After that, cancellation fees may apply.
                                                            {% endif %}
                                                        </div>
                                                    </div>
                                                    <div class="modal-footer">
                                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Keep Booking</button>
                                                        <form action="{{ url_for('cancel_event_booking', booking_id=booking.Event_Booking_ID) }}" method="post">
                                                            <button type="submit" class="btn btn-danger">Confirm Cancellation</button>
                                                        </form>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <div class="text-center py-5">
                        <i class="fas fa-calendar-day fa-5x text-muted mb-3"></i>
                        <h4>No Event Bookings Found</h4>
                        <p class="text-muted">You haven't booked any events yet. Explore our exciting events!</p>
                        <a href="{{ url_for('events') }}" class="btn btn-success">Explore Events</a>
                    </div>
                    {% endif %}
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-6 mb-4">
                    <div class="card dashboard-card shadow h-100">
                        <div class="card-header bg-info text-white">
                            <h5 class="mb-0">Special Offers</h5>
                        </div>
                        <div class="card-body">
                            <div class="alert alert-info">
                                <strong>Weekend Special!</strong> 15% off on weekend stays.
                                <br><small>Use code: <span class="badge bg-dark">WEEKEND15</span></small>
                            </div>
                            <div class="alert alert-info">
                                <strong>Extended Stay Discount!</strong> 20% off for bookings of 5+ nights.
                                <br><small>Use code: <span class="badge bg-dark">EXTENDED20</span></small>
                            </div>
                            <div class="alert alert-info">
                                <strong>Early Bird Special!</strong> Book 30 days in advance and get 10% off.
                                <br><small>Use code: <span class="badge bg-dark">EARLYBIRD10</span></small>
                            </div>
                            <a href="{{ url_for('rooms') }}" class="btn btn-outline-info w-100">View All Offers</a>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 mb-4">
                    <div class="card dashboard-card shadow h-100">
                        <div class="card-header bg-primary text-white">
                            <h5 class="mb-0">Upcoming Events</h5>
                        </div>
                        <div class="card-body">
                            {% if event_bookings %}
                                {% for booking in event_bookings %}
                                    {% if booking.Status != 'Canceled' and booking.event_details and booking.event_details.Event_Date >= today %}
                                    <div class="upcoming-event mb-3">
                                        <div class="d-flex align-items-center">
                                            <div class="event-date text-center me-3 bg-light rounded p-2">
                                                <span class="d-block text-primary fw-bold">{{ booking.event_details.Event_Date.strftime('%d') }}</span>
                                                <small class="text-muted">{{ booking.event_details.Event_Date.strftime('%b') }}</small>
                                            </div>
                                            <div>
                                                <h6 class="mb-1">{{ booking.event_details.Event_Name }}</h6>
                                                <small class="text-muted"><i class="fas fa-map-marker-alt me-1"></i> {{ booking.event_details.Location }}</small>
                                            </div>
                                        </div>
                                    </div>
                                    {% endif %}
                                {% endfor %}
                                <a href="{{ url_for('events') }}" class="btn btn-outline-primary w-100">View All Events</a>
                            {% else %}
                                <div class="upcoming-event mb-3">
                                    <div class="d-flex align-items-center">
                                        <div class="event-date text-center me-3 bg-light rounded p-2">
                                            <span class="d-block text-primary fw-bold">25</span>
                                            <small class="text-muted">MAY</small>
                                        </div>
                                        <div>
                                            <h6 class="mb-1">Wine Tasting Night</h6>
                                            <small class="text-muted"><i class="fas fa-map-marker-alt me-1"></i> Hotel Lounge</small>
                                        </div>
                                    </div>
                                </div>
                                <div class="upcoming-event mb-3">
                                    <div class="d-flex align-items-center">
                                        <div class="event-date text-center me-3 bg-light rounded p-2">
                                            <span class="d-block text-primary fw-bold">30</span>
                                            <small class="text-muted">MAY</small>
                                        </div>
                                        <div>
                                            <h6 class="mb-1">Live Jazz Music</h6>
                                            <small class="text-muted"><i class="fas fa-map-marker-alt me-1"></i> Rooftop Bar</small>
                                        </div>
                                    </div>
                                </div>
                                <div class="upcoming-event mb-3">
                                    <div class="d-flex align-items-center">
                                        <div class="event-date text-center me-3 bg-light rounded p-2">
                                            <span class="d-block text-primary fw-bold">05</span>
                                            <small class="text-muted">JUN</small>
                                        </div>
                                        <div>
                                            <h6 class="mb-1">Cooking Class</h6>
                                            <small class="text-muted"><i class="fas fa-map-marker-alt me-1"></i> Hotel Kitchen</small>
                                        </div>
                                    </div>
                                </div>
                                <a href="{{ url_for('events') }}" class="btn btn-outline-primary w-100">View All Events</a>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
    .dashboard-card {
        border-radius: 10px;
        overflow: hidden;
        border: none;
    }
    
    .event-date {
        width: 50px;
        height: 50px;
        display: flex;
        flex-direction: column;
        justify-content: center;
    }
    
    .upcoming-event {
        padding-bottom: 10px;
        border-bottom: 1px solid #eee;
    }
    
    .upcoming-event:last-child {
        border-bottom: none;
    }
</style>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Direct maintenance link
        const directMaintenanceLink = document.getElementById('direct-maintenance-link');
        if (directMaintenanceLink) {
            directMaintenanceLink.addEventListener('click', function(e) {
                // Allow default navigation to work - remove the custom handling
                console.log('Direct maintenance link clicked');
            });
        }
    });
</script>
{% endblock %}